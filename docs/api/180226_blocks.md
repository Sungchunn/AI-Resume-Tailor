# Blocks/Vault API

## Overview

The Blocks API (also known as the Vault) provides management for individual content blocks that make up a resume. Blocks are reusable pieces of content (achievements, responsibilities, skills) that can be mixed and matched when building tailored resumes.

**Base Path:** `/v1/blocks`

**Authentication:** All endpoints require authentication.

---

## Block Types

| Type | Description |
|------|-------------|
| `ACHIEVEMENT` | Quantified accomplishments and results |
| `RESPONSIBILITY` | Job duties and responsibilities |
| `SKILL` | Technical or soft skills |
| `EDUCATION` | Educational qualifications |
| `CERTIFICATION` | Professional certifications |
| `PROJECT` | Project descriptions |
| `SUMMARY` | Professional summary or objective |
| `OTHER` | Miscellaneous content |

---

## Endpoints

### Create Block

Create a new content block.

```
POST /v1/blocks
```

**Request Body:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `content` | string | Yes | The block content text |
| `block_type` | string | Yes | One of the block type enums |
| `tags` | string[] | No | Categorization tags |
| `source_company` | string | No | Company where this was achieved |
| `source_role` | string | No | Role when this was achieved |
| `source_date_start` | date | No | Start date of the experience |
| `source_date_end` | date | No | End date of the experience |

**Example Request:**

```bash
curl -X POST http://localhost:8000/v1/blocks \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "Led migration of monolithic application to microservices architecture, reducing deployment time by 75% and improving system reliability to 99.9% uptime",
    "block_type": "ACHIEVEMENT",
    "tags": ["architecture", "devops", "leadership"],
    "source_company": "TechCorp",
    "source_role": "Senior Software Engineer",
    "source_date_start": "2022-01-01",
    "source_date_end": "2024-12-31"
  }'
```

**Response (201 Created):**

```json
{
  "id": "880e8400-e29b-41d4-a716-446655440000",
  "user_id": "660e8400-e29b-41d4-a716-446655440001",
  "content": "Led migration of monolithic application to microservices architecture...",
  "block_type": "ACHIEVEMENT",
  "tags": ["architecture", "devops", "leadership"],
  "source_company": "TechCorp",
  "source_role": "Senior Software Engineer",
  "source_date_start": "2022-01-01",
  "source_date_end": "2024-12-31",
  "verified": false,
  "embedding": null,
  "created_at": "2026-02-18T10:30:00.000000",
  "updated_at": "2026-02-18T10:30:00.000000"
}
```

---

### List Blocks

Retrieve blocks with optional filtering.

```
GET /v1/blocks
```

**Query Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `block_types` | string[] | All | Filter by block types |
| `tags` | string[] | None | Filter by tags |
| `verified_only` | boolean | false | Only return verified blocks |
| `limit` | integer | 50 | Maximum results (1-100) |
| `offset` | integer | 0 | Pagination offset |

**Example Request:**

```bash
curl "http://localhost:8000/v1/blocks?block_types=ACHIEVEMENT&block_types=SKILL&tags=python&limit=20" \
  -H "Authorization: Bearer <token>"
```

**Response (200 OK):**

```json
{
  "blocks": [
    {
      "id": "880e8400-e29b-41d4-a716-446655440000",
      "user_id": "660e8400-e29b-41d4-a716-446655440001",
      "content": "Led migration of monolithic application...",
      "block_type": "ACHIEVEMENT",
      "tags": ["architecture", "devops", "leadership"],
      "verified": true,
      "created_at": "2026-02-18T10:30:00.000000",
      "updated_at": "2026-02-18T10:30:00.000000"
    }
  ],
  "total": 1,
  "limit": 20,
  "offset": 0
}
```

---

### Get Block

Retrieve a specific block by ID.

```
GET /v1/blocks/{block_id}
```

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `block_id` | UUID | Block identifier |

**Example Request:**

```bash
curl http://localhost:8000/v1/blocks/880e8400-e29b-41d4-a716-446655440000 \
  -H "Authorization: Bearer <token>"
```

**Response (200 OK):**

```json
{
  "id": "880e8400-e29b-41d4-a716-446655440000",
  "user_id": "660e8400-e29b-41d4-a716-446655440001",
  "content": "Led migration of monolithic application to microservices architecture...",
  "block_type": "ACHIEVEMENT",
  "tags": ["architecture", "devops", "leadership"],
  "source_company": "TechCorp",
  "source_role": "Senior Software Engineer",
  "source_date_start": "2022-01-01",
  "source_date_end": "2024-12-31",
  "verified": false,
  "embedding": [...],
  "created_at": "2026-02-18T10:30:00.000000",
  "updated_at": "2026-02-18T10:30:00.000000"
}
```

---

### Update Block

Partially update a block.

```
PATCH /v1/blocks/{block_id}
```

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `block_id` | UUID | Block identifier |

**Request Body:**

All fields are optional:

| Field | Type | Description |
|-------|------|-------------|
| `content` | string | Updated content |
| `block_type` | string | Updated block type |
| `tags` | string[] | Updated tags |
| `source_company` | string | Updated company |
| `source_role` | string | Updated role |
| `source_date_start` | date | Updated start date |
| `source_date_end` | date | Updated end date |

**Example Request:**

```bash
curl -X PATCH http://localhost:8000/v1/blocks/880e8400-e29b-41d4-a716-446655440000 \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["architecture", "devops", "leadership", "microservices"]
  }'
```

**Response (200 OK):**

Returns the updated block.

---

### Delete Block

Delete a block from the vault.

```
DELETE /v1/blocks/{block_id}
```

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `block_id` | UUID | Block identifier |

**Example Request:**

```bash
curl -X DELETE http://localhost:8000/v1/blocks/880e8400-e29b-41d4-a716-446655440000 \
  -H "Authorization: Bearer <token>"
```

**Response (204 No Content):**

No response body.

---

### Verify Block

Mark a block as verified (user-confirmed accuracy).

```
POST /v1/blocks/{block_id}/verify
```

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `block_id` | UUID | Block identifier |

**Request Body:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `verified` | boolean | Yes | Verification status |

**Example Request:**

```bash
curl -X POST http://localhost:8000/v1/blocks/880e8400-e29b-41d4-a716-446655440000/verify \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"verified": true}'
```

**Response (200 OK):**

Returns the updated block with `verified: true`.

---

### Import Blocks

Bulk import blocks from raw resume content.

```
POST /v1/blocks/import
```

**Request Body:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `raw_content` | string | Yes | Resume text to parse |
| `source_company` | string | No | Company context |
| `source_role` | string | No | Role context |

**Example Request:**

```bash
curl -X POST http://localhost:8000/v1/blocks/import \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "raw_content": "Experience:\n- Led migration to microservices, reducing deployment time by 75%\n- Mentored team of 5 junior developers\n- Implemented CI/CD pipeline using GitHub Actions",
    "source_company": "TechCorp",
    "source_role": "Senior Engineer"
  }'
```

**Response (201 Created):**

```json
{
  "imported_count": 3,
  "blocks": [
    {
      "id": "880e8400-e29b-41d4-a716-446655440001",
      "content": "Led migration to microservices, reducing deployment time by 75%",
      "block_type": "ACHIEVEMENT",
      "verified": false,
      ...
    },
    {
      "id": "880e8400-e29b-41d4-a716-446655440002",
      "content": "Mentored team of 5 junior developers",
      "block_type": "RESPONSIBILITY",
      "verified": false,
      ...
    },
    {
      "id": "880e8400-e29b-41d4-a716-446655440003",
      "content": "Implemented CI/CD pipeline using GitHub Actions",
      "block_type": "ACHIEVEMENT",
      "verified": false,
      ...
    }
  ]
}
```

---

### Generate Embeddings (Bulk)

Generate semantic embeddings for multiple blocks.

```
POST /v1/blocks/embed
```

**Request Body:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `block_ids` | UUID[] | No | Specific blocks to embed (all if omitted) |

**Example Request:**

```bash
curl -X POST http://localhost:8000/v1/blocks/embed \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "block_ids": [
      "880e8400-e29b-41d4-a716-446655440001",
      "880e8400-e29b-41d4-a716-446655440002"
    ]
  }'
```

**Response (200 OK):**

```json
{
  "embedded_count": 2,
  "block_ids": [
    "880e8400-e29b-41d4-a716-446655440001",
    "880e8400-e29b-41d4-a716-446655440002"
  ]
}
```

---

### Generate Embedding (Single)

Generate semantic embedding for a single block.

```
POST /v1/blocks/{block_id}/embed
```

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `block_id` | UUID | Block identifier |

**Example Request:**

```bash
curl -X POST http://localhost:8000/v1/blocks/880e8400-e29b-41d4-a716-446655440000/embed \
  -H "Authorization: Bearer <token>"
```

**Response (200 OK):**

Returns the block with updated embedding.

---

## Data Models

### BlockCreate

```typescript
{
  content: string;               // Required
  block_type: BlockType;         // Required (enum)
  tags?: string[];               // Optional
  source_company?: string;       // Optional
  source_role?: string;          // Optional
  source_date_start?: string;    // Optional (YYYY-MM-DD)
  source_date_end?: string;      // Optional (YYYY-MM-DD)
}
```

### BlockUpdate

```typescript
{
  content?: string;
  block_type?: BlockType;
  tags?: string[];
  source_company?: string;
  source_role?: string;
  source_date_start?: string;
  source_date_end?: string;
}
```

### BlockResponse

```typescript
{
  id: string;                    // UUID
  user_id: string;               // UUID
  content: string;
  block_type: BlockType;
  tags: string[];
  source_company: string | null;
  source_role: string | null;
  source_date_start: string | null;
  source_date_end: string | null;
  verified: boolean;
  embedding: number[] | null;    // Vector embedding
  created_at: string;
  updated_at: string;
}
```

### BlockListResponse

```typescript
{
  blocks: BlockResponse[];
  total: number;
  limit: number;
  offset: number;
}
```

### BlockImportResponse

```typescript
{
  imported_count: number;
  blocks: BlockResponse[];
}
```

### BlockEmbedResponse

```typescript
{
  embedded_count: number;
  block_ids: string[];
}
```

## Usage Notes

- Blocks should be atomic, self-contained pieces of content
- Use verification to mark content you've reviewed and confirmed
- Embeddings enable semantic search for job matching
- Tags help with filtering and organization
- Source metadata helps track where content originated

## Related Endpoints

- [Semantic Match](180226_tailor-match.md) - Find blocks matching job requirements
- [Workshops](180226_workshops.md) - Pull blocks into resume editing sessions
- [ATS Analysis](180226_ats.md) - Analyze keyword coverage using blocks
